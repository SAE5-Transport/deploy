- name: "[MAIN] Check if Docker Compose project exists"
  stat:
    path: "~/lemonldap/docker-compose.yml"
  register: compose_file

- name: "[MAIN] Stop & Remove Images/Volumes"
  community.docker.docker_compose_v2:
    project_src: "~/lemonldap/"
    state: absent
    remove_images: local
    remove_volumes: yes
  when: compose_file.stat.exists

- name: "[MAIN] Remove Docker Compose files"
  ansible.builtin.file:
    state: absent
    path: "~/lemonldap/"

- name: "[MAIN] Copy Docker Compose files"
  ansible.builtin.copy:
    dest: "~/lemonldap/"
    src: "../files/"

- name: "[MAIN] Copy Docker Compose"
  ansible.builtin.template:
       src: "../templates/docker-compose.yml.j2"
       dest: "~/lemonldap/docker-compose.yml"

- name: "[MAIN] up compose"
  community.docker.docker_compose_v2:
    project_src: "~/lemonldap/"
    remove_orphans: yes